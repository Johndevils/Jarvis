<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARVIS AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Orbitron', monospace;
            background: #000;
            overflow: hidden;
        }
        
        .glow-cyan {
            box-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff, 0 0 60px #00ffff;
        }
        
        .glow-blue {
            box-shadow: 0 0 10px #0080ff, 0 0 20px #0080ff;
        }
        
        .text-glow {
            text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;
        }
        
        .scanner-line {
            height: 2px;
            width: 100%;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scan 3s infinite linear;
        }
        
        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(200px); }
        }
        
        .audio-bar {
            width: 4px;
            background: #00ffff;
            margin: 0 2px;
            animation: pulse 0.5s infinite alternate;
        }
        
        @keyframes pulse {
            0% { height: 5px; }
            100% { height: 20px; }
        }
        
        .hud-border {
            border: 1px solid rgba(0, 255, 255, 0.3);
            position: relative;
        }
        
        .hud-corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #00ffff;
        }
        
        .hud-corner-tl {
            top: -1px;
            left: -1px;
            border-right: none;
            border-bottom: none;
        }
        
        .hud-corner-tr {
            top: -1px;
            right: -1px;
            border-left: none;
            border-bottom: none;
        }
        
        .hud-corner-bl {
            bottom: -1px;
            left: -1px;
            border-right: none;
            border-top: none;
        }
        
        .hud-corner-br {
            bottom: -1px;
            right: -1px;
            border-left: none;
            border-top: none;
        }
        
        .circular-video {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #00ffff;
            box-shadow: 0 0 30px #00ffff, inset 0 0 30px rgba(0, 255, 255, 0.3);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .listening-indicator {
            animation: pulse-ring 1.5s infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(0, 255, 255, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(0, 255, 255, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(0, 255, 255, 0);
            }
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col">
    <!-- Header with clock and settings -->
    <header class="p-4 flex justify-between items-center">
        <div class="text-xl font-bold text-glow">J.A.R.V.I.S.</div>
        <div id="clock" class="text-lg text-cyan-400"></div>
        <button id="settings-btn" class="text-cyan-400 hover:text-cyan-300 transition-colors">
            <i class="fas fa-cog text-xl"></i>
        </button>
    </header>

    <!-- Main content -->
    <main class="flex-1 flex flex-col items-center justify-center p-4">
        <!-- Video container -->
        <div class="relative mb-8">
            <video id="jarvis-video" class="circular-video" autoplay muted loop>
                <source src="jarvis.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div id="listening-indicator" class="absolute inset-0 rounded-full border-2 border-cyan-400 hidden listening-indicator"></div>
        </div>

        <!-- Audio visualizer -->
        <div id="audio-visualizer" class="flex items-end justify-center h-8 mb-8 hidden">
            <div class="audio-bar"></div>
            <div class="audio-bar" style="animation-delay: 0.1s"></div>
            <div class="audio-bar" style="animation-delay: 0.2s"></div>
            <div class="audio-bar" style="animation-delay: 0.3s"></div>
            <div class="audio-bar" style="animation-delay: 0.4s"></div>
            <div class="audio-bar" style="animation-delay: 0.5s"></div>
            <div class="audio-bar" style="animation-delay: 0.6s"></div>
            <div class="audio-bar" style="animation-delay: 0.7s"></div>
        </div>

        <!-- Status indicator -->
        <div id="status" class="text-center mb-4 text-cyan-400">Ready</div>

        <!-- Log window -->
        <div class="w-full max-w-4xl h-48 p-4 bg-gray-900 bg-opacity-70 rounded-lg hud-border overflow-y-auto">
            <div class="hud-corner hud-corner-tl"></div>
            <div class="hud-corner hud-corner-tr"></div>
            <div class="hud-corner hud-corner-bl"></div>
            <div class="hud-corner hud-corner-br"></div>
            <div id="log" class="text-sm text-cyan-300 font-mono"></div>
            <div class="scanner-line absolute top-0 left-0"></div>
        </div>
    </main>

    <!-- Security Modal -->
    <div id="security-modal" class="fixed inset-0 flex items-center justify-center z-50 modal-backdrop">
        <div class="bg-gray-900 p-8 rounded-lg border border-cyan-400 max-w-md w-full mx-4 glow-cyan">
            <h2 class="text-2xl font-bold mb-6 text-center text-cyan-400">Security Clearance Required</h2>
            <p class="mb-4 text-gray-300">Please enter your Hugging Face API Token to activate J.A.R.V.I.S.</p>
            <div class="mb-6">
                <label for="api-token" class="block text-sm font-medium mb-2">API Token</label>
                <input type="password" id="api-token" class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="hf_xxxxxxxxxxxxxxxx">
            </div>
            <button id="save-token" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded transition-colors">
                Activate J.A.R.V.I.S.
            </button>
            <p class="mt-4 text-xs text-gray-400 text-center">Your token is encrypted and stored locally in your browser.</p>
        </div>
    </div>

    <script>
        // Global variables
        let recognition;
        let isListening = false;
        let apiToken = null;
        const ENCRYPTION_KEY = "JARVIS_SECURITY_KEY_2023";

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            updateClock();
            setInterval(updateClock, 1000);
            
            // Check for stored token
            const storedToken = localStorage.getItem('jarvis_token');
            if (storedToken) {
                try {
                    apiToken = decryptToken(storedToken);
                    initializeSpeechRecognition();
                    addLog("J.A.R.V.I.S. online and ready, Sir.");
                } catch (e) {
                    showSecurityModal();
                }
            } else {
                showSecurityModal();
            }
            
            // Event listeners
            document.getElementById('save-token').addEventListener('click', saveToken);
            document.getElementById('settings-btn').addEventListener('click', showSecurityModal);
        });

        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
        }

        // Token encryption/decryption
        function encryptToken(token) {
            return CryptoJS.AES.encrypt(token, ENCRYPTION_KEY).toString();
        }

        function decryptToken(encryptedToken) {
            const bytes = CryptoJS.AES.decrypt(encryptedToken, ENCRYPTION_KEY);
            return bytes.toString(CryptoJS.enc.Utf8);
        }

        // Save token to localStorage
        function saveToken() {
            const tokenInput = document.getElementById('api-token');
            const token = tokenInput.value.trim();
            
            if (!token) {
                alert("Please enter a valid API token");
                return;
            }
            
            try {
                const encryptedToken = encryptToken(token);
                localStorage.setItem('jarvis_token', encryptedToken);
                apiToken = token;
                hideSecurityModal();
                initializeSpeechRecognition();
                addLog("Security credentials verified. J.A.R.V.I.S. is now online, Sir.");
            } catch (e) {
                console.error("Error saving token:", e);
                alert("Error saving token. Please try again.");
            }
        }

        // Modal functions
        function showSecurityModal() {
            document.getElementById('security-modal').classList.remove('hidden');
            if (apiToken) {
                document.getElementById('api-token').value = apiToken;
            }
        }

        function hideSecurityModal() {
            document.getElementById('security-modal').classList.add('hidden');
            document.getElementById('api-token').value = '';
        }

        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                addLog("Speech recognition not supported in this browser, Sir.");
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            recognition.onstart = () => {
                isListening = true;
                updateStatus("Listening...");
                document.getElementById('listening-indicator').classList.remove('hidden');
                document.getElementById('audio-visualizer').classList.remove('hidden');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                addLog(`You: ${transcript}`);
                processCommand(transcript);
            };
            
            recognition.onerror = (event) => {
                console.error("Speech recognition error:", event.error);
                addLog(`Error: ${event.error}, Sir.`);
                updateStatus("Ready");
                isListening = false;
                document.getElementById('listening-indicator').classList.add('hidden');
                document.getElementById('audio-visualizer').classList.add('hidden');
            };
            
            recognition.onend = () => {
                isListening = false;
                updateStatus("Ready");
                document.getElementById('listening-indicator').classList.add('hidden');
                document.getElementById('audio-visualizer').classList.add('hidden');
            };
            
            // Start listening automatically
            setTimeout(() => {
                startListening();
            }, 1000);
        }

        // Start listening
        function startListening() {
            if (recognition && !isListening) {
                recognition.start();
            }
        }

        // Update status
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // Add log entry
        function addLog(message) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Process command
        function processCommand(command) {
            // Browser controls
            if (command === "go back") {
                history.back();
                addLog("Navigating back, Sir.");
                return;
            }
            
            if (command === "refresh") {
                location.reload();
                addLog("Refreshing the page, Sir.");
                return;
            }
            
            if (command === "print") {
                window.print();
                addLog("Printing the page, Sir.");
                return;
            }
            
            // Search routing
            let match;
            
            // YouTube search
            if ((match = command.match(/(?:youtube|play)\s+(.+)/i))) {
                const query = encodeURIComponent(match[1]);
                window.open(`https://www.youtube.com/results?search_query=${query}`, '_blank');
                addLog(`Searching YouTube for "${match[1]}", Sir.`);
                return;
            }
            
            // GitHub search
            if ((match = command.match(/(?:github|repo)\s+(.+)/i))) {
                const query = encodeURIComponent(match[1]);
                window.open(`https://github.com/search?q=${query}`, '_blank');
                addLog(`Searching GitHub for "${match[1]}", Sir.`);
                return;
            }
            
            // DuckDuckGo search
            if ((match = command.match(/(?:duckduckgo|private search)\s+(.+)/i))) {
                const query = encodeURIComponent(match[1]);
                window.open(`https://duckduckgo.com/?q=${query}`, '_blank');
                addLog(`Searching privately for "${match[1]}", Sir.`);
                return;
            }
            
            // Generic Google search
            if ((match = command.match(/search\s+(.+)/i))) {
                const query = encodeURIComponent(match[1]);
                window.open(`https://www.google.com/search?q=${query}`, '_blank');
                addLog(`Searching Google for "${match[1]}", Sir.`);
                return;
            }
            
            // Open website
            if ((match = command.match(/open\s+(.+)/i))) {
                let url = match[1];
                if (!url.startsWith('http')) {
                    if (!url.includes('.')) {
                        url += '.com';
                    }
                    url = 'https://' + url;
                }
                window.open(url, '_blank');
                addLog(`Opening ${url}, Sir.`);
                return;
            }
            
            // AI fallback
            if (apiToken) {
                queryAI(command);
            } else {
                addLog("No API token available. Please set your Hugging Face token, Sir.");
            }
        }

        // Query AI
        async function queryAI(query) {
            updateStatus("Thinking...");
            addLog("Querying AI...");
            
            try {
                const response = await fetch("https://api-inference.huggingface.co/models/deepseek-ai/deepseek-v3", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiToken}`,
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        inputs: `You are Jarvis. Be brief, precise, and witty. Address me as Sir. User query: ${query}`,
                        parameters: {
                            max_new_tokens: 100,
                            temperature: 0.7,
                        }
                    }),
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data[0]?.generated_text || "I'm sorry, Sir. I couldn't process that request.";
                
                // Extract just the response part
                const responseText = aiResponse.includes("User query:") 
                    ? aiResponse.split("User query:")[1].trim() 
                    : aiResponse;
                
                addLog(`J.A.R.V.I.S.: ${responseText}`);
                speak(responseText);
            } catch (error) {
                console.error("AI query error:", error);
                addLog(`Error: ${error.message}, Sir.`);
            } finally {
                updateStatus("Ready");
            }
        }

        // Text to speech
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 0.8;
                utterance.volume = 0.8;
                
                // Find a voice that sounds like Jarvis
                const voices = speechSynthesis.getVoices();
                const britishVoice = voices.find(voice => 
                    voice.name.includes('British') || 
                    voice.name.includes('UK') || 
                    voice.name.includes('Daniel')
                );
                
                if (britishVoice) {
                    utterance.voice = britishVoice;
                }
                
                speechSynthesis.speak(utterance);
            } else {
                console.error("Speech synthesis not supported");
            }
        }

        // Load voices when available
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => {
                // Voices are loaded
            };
        }
    </script>
</body>
</html>
